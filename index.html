<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Profissional</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8fafc; color: #334155; }
.banner-grande { width: 100%; height: 45vh; min-height: 300px; max-height: 500px; overflow: hidden; position: relative; }
.banner-grande img { width: 100%; height: 100%; object-fit: cover; }
.overlay-banner { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.7)); color: white; padding: 25px; }
.botoes-acoes { padding: 20px; display: flex; flex-direction: column; gap: 12px; }
.btn-acao { padding: 18px; background: white; border: 2px solid #e2e8f0; border-radius: 12px; color: #475569; font-size: 17px; font-weight: 600; text-align: center; cursor: pointer; transition: all 0.2s ease; }
.btn-acao:hover { background: #f1f5f9; border-color: #94a3b8; transform: translateY(-2px); }
.servicos-container, .calendario-compacto, .horarios-container, .formulario-agendamento, .area-cliente, .admin-container, .ajuda-container, .pdf-container, .profissionais-container { padding: 25px; display: none; }
.card-servico { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 5px solid #3b82f6; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.info-servico { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; }
.info-servico div { padding: 10px; background: #f8fafc; border-radius: 8px; }
.info-servico strong { display: block; color: #64748b; font-size: 14px; margin-bottom: 5px; }
.info-servico span { color: #1e293b; font-weight: 600; }
.header-calendario { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
.titulo-calendario { font-size: 22px; font-weight: 700; color: #1e293b; }
.btn-navegar { background: #f1f5f9; border: none; width: 44px; height: 44px; border-radius: 50%; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.semanas-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-bottom: 15px; }
.dia-semana { text-align: center; font-weight: 600; color: #64748b; font-size: 14px; padding: 10px 0; }
.dias-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
.dia { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; background: white; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
.dia:hover { background: #3b82f6; color: white; border-color: #3b82f6; }
.dia.selecionado { background: #ef4444; color: white; border-color: #ef4444; }
.dia.desabilitado { background: #fee2e2; color: #dc2626; cursor: not-allowed; }
.dia.feriado { background: #fee2e2; color: #dc2626; border-color: #fca5a5; }
.dia.hoje { background: #10b981; color: white; border-color: #10b981; font-weight: 700; }
.horarios-lista { display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto; }
.horario-item { padding: 18px; background: white; border: 2px solid #e2e8f0; border-radius: 10px; text-align: center; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
.horario-item:hover { background: #dcfce7; border-color: #22c55e; }
.horario-item.selecionado { background: #22c55e; color: white; border-color: #22c55e; }
.horario-item.indisponivel { background: #fee2e2; color: #dc2626; opacity: 0.5; cursor: not-allowed; }
.profissional-item { padding: 20px; background: white; border: 2px solid #e2e8f0; border-radius: 12px; margin-bottom: 15px; cursor: pointer; transition: all 0.2s ease; }
.profissional-item:hover { background: #f0f9ff; border-color: #3b82f6; }
.profissional-item.selecionado { background: #3b82f6; color: white; border-color: #3b82f6; }
.form-group { margin-bottom: 20px; }
.form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #475569; }
.form-input { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; transition: all 0.2s ease; }
.form-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
.agenda-lista { display: flex; flex-direction: column; gap: 15px; }
.item-agenda { background: white; border-left: 5px solid #3b82f6; border-radius: 10px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; }
.form-admin { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 2px solid #e2e8f0; }
.grid-admin { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
.btn-admin { background: #3b82f6; color: white; border: none; padding: 15px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; width: 100%; }
.btn-admin:hover { background: #2563eb; }
.btn-limpar { background: #64748b; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; margin-top: 10px; }
.btn-limpar:hover { background: #475569; }
.lista-agendamentos-admin { display: flex; flex-direction: column; gap: 12px; margin-bottom: 30px; }
.agendamento-item { background: white; border-radius: 10px; padding: 20px; border: 2px solid #e2e8f0; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; position: relative; }
.config-horarios { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
.config-box { background: white; border-radius: 12px; padding: 20px; border: 2px solid #e2e8f0; }
.cadastro-servico { background: white; border-radius: 12px; padding: 25px; border: 2px solid #e2e8f0; }
.grid-servico { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
.ticket-agendamento { max-width: 500px; margin: 0 auto; border: 2px dashed #94a3b8; border-radius: 15px; padding: 30px; background: white; }
.barra-inferior { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 2px solid #e2e8f0; display: flex; padding: 12px; gap: 8px; z-index: 1000; }
.btn-nav { flex: 1; background: white; border: 2px solid #e2e8f0; border-radius: 10px; padding: 10px; color: #64748b; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.2s ease; display: flex; flex-direction: column; align-items: center; gap: 5px; }
.btn-nav:hover { background: #f1f5f9; color: #475569; }
.btn-nav.ativo { background: #3b82f6; color: white; border-color: #3b82f6; }
.topico-ajuda { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 5px solid #3b82f6; }
.mensagem { position: fixed; top: 20px; right: 20px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 15px; z-index: 2000; border-left: 5px solid; max-width: 350px; animation: slideIn 0.3s ease; }
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.mensagem.sucesso { border-left-color: #10b981; }
.mensagem.erro { border-left-color: #ef4444; }
.mensagem.info { border-left-color: #3b82f6; }
.login-admin { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 3000; display: none; }
.modal-admin { background: white; border-radius: 15px; padding: 40px; width: 90%; max-width: 400px; }
.voltar-btn { background: none; border: none; color: #64748b; font-size: 16px; cursor: pointer; display: flex; align-items: center; gap: 10px; margin-bottom: 20px; padding: 10px; border-radius: 8px; }
.voltar-btn:hover { background: #f1f5f9; }
.titulo-secao { font-size: 24px; color: #1e293b; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0; }
.loading { text-align: center; padding: 40px; color: #64748b; }
.loading-spinner { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.container-principal { padding-bottom: 80px; }
.btn-excluir { background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: 600; }
.btn-excluir:hover { background: #dc2626; }
.lixeira-individual { position: absolute; top: 10px; right: 10px; background: #ef4444; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; }
.lixeira-individual:hover { background: #dc2626; }
@media (max-width: 768px) { .banner-grande { height: 35vh; min-height: 250px; } .dias-grid, .semanas-grid { gap: 4px; } .dia { font-size: 14px; } .grid-servico, .config-horarios, .agendamento-item, .info-servico { grid-template-columns: 1fr; } .lixeira-individual { top: 5px; right: 5px; width: 25px; height: 25px; font-size: 14px; } }
</style>


<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3a0060">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">


</head>
<body>
<div class="banner-grande">
  <img src="banner.png" alt="Banner">
  <div class="overlay-banner">
    <h1 style="font-size: 28px; margin-bottom: 5px;">Barbearia Jo√£o</h1>
    <p style="opacity: 0.9;">Agendamento online ‚Ä¢ R$19,90/m√™s</p>
  </div>
</div>

<div class="container-principal">
  <div class="botoes-acoes" id="telaInicial">
    <button class="btn-acao" onclick="mostrarServicos()">üíà Servi√ßos</button>
    <button class="btn-acao" onclick="mostrarCalendario()">üìÖ Agendar</button>
    <button class="btn-acao" onclick="mostrarAreaCliente()">üë§ Sua agenda</button>
  </div>
  
  <div class="servicos-container" id="telaServicos">
    <button class="voltar-btn" onclick="voltarInicio()">‚Üê Voltar</button>
    <h2 class="titulo-secao">üíà Servi√ßos</h2>
    <div id="listaServicosCliente"><div class="loading"><div class="loading-spinner"></div>Carregando...</div></div>
  </div>
  
  <div class="calendario-compacto" id="telaCalendario">
    <button class="voltar-btn" onclick="voltarInicio()">‚Üê Voltar</button>
    <div class="header-calendario">
      <button class="btn-navegar" onclick="mesAnterior()">‚óÄ</button>
      <h2 class="titulo-secao" id="mesAtual">Fevereiro 2024</h2>
      <button class="btn-navegar" onclick="proximoMes()">‚ñ∂</button>
    </div>
    <div class="semanas-grid">
      <div class="dia-semana">Dom</div><div class="dia-semana">Seg</div><div class="dia-semana">Ter</div>
      <div class="dia-semana">Qua</div><div class="dia-semana">Qui</div><div class="dia-semana">Sex</div>
      <div class="dia-semana">S√°b</div>
    </div>
    <div class="dias-grid" id="gradeDias"></div>
  </div>
  
  <div class="profissionais-container" id="telaProfissionais">
    <button class="voltar-btn" onclick="mostrarCalendario()">‚Üê Voltar</button>
    <h2 class="titulo-secao">Selecione o Profissional</h2>
    <p style="margin-bottom: 20px; color: #64748b;" id="dataSelecionada"></p>
    <div id="listaProfissionais"><div class="loading"><div class="loading-spinner"></div>Carregando...</div></div>
  </div>
  
  <div class="horarios-container" id="telaHorarios">
    <button class="voltar-btn" onclick="mostrarProfissionais()">‚Üê Voltar</button>
    <h2 class="titulo-secao">Escolha o hor√°rio</h2>
    <p style="margin-bottom: 20px; color: #64748b;">Profissional: <span id="profissionalSelecionadoNome"></span></p>
    <div class="horarios-lista" id="listaHorarios"><div class="loading"><div class="loading-spinner"></div>Carregando...</div></div>
  </div>
  
  <div class="formulario-agendamento" id="telaFormulario">
    <button class="voltar-btn" onclick="mostrarHorarios()">‚Üê Voltar</button>
    <h2 class="titulo-secao">Finalizar agendamento</h2>
    <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 2px solid #e0f2fe;">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div><strong style="color: #64748b; display: block; font-size: 14px;">Profissional</strong><span id="resumoProfissional" style="color: #1e293b; font-weight: 600;"></span></div>
        <div><strong style="color: #64748b; display: block; font-size: 14px;">Servi√ßo</strong><span id="resumoServico" style="color: #1e293b; font-weight: 600;"></span></div>
        <div><strong style="color: #64748b; display: block; font-size: 14px;">Data</strong><span id="resumoData" style="color: #1e293b; font-weight: 600;"></span></div>
        <div><strong style="color: #64748b; display: block; font-size: 14px;">Hor√°rio</strong><span id="resumoHorario" style="color: #1e293b; font-weight: 600;"></span></div>
        <div><strong style="color: #64748b; display: block; font-size: 14px;">Dura√ß√£o</strong><span id="resumoDuracao" style="color: #1e293b; font-weight: 600;"></span></div>
        <div><strong style="color: #64748b; display: block; font-size: 14px;">Valor</strong><span id="resumoValor" style="color: #1e293b; font-weight: 600;"></span></div>
      </div>
    </div>
    <div class="form-group"><label class="form-label">Nome completo</label><input type="text" class="form-input" id="nomeCliente" placeholder="Seu nome"></div>
    <div class="form-group"><label class="form-label">Telefone/WhatsApp</label><input type="tel" class="form-input" id="telefoneCliente" placeholder="(11) 99999-9999"></div>
    <button class="btn-admin" onclick="confirmarAgendamento()">‚úÖ Confirmar Agendamento</button>
  </div>
  
  <div class="area-cliente" id="telaCliente">
    <button class="voltar-btn" onclick="voltarInicio()">‚Üê Voltar</button>
    <h2 class="titulo-secao">Sua agenda</h2>
    <div class="agenda-lista" id="listaAgendaCliente"><div class="loading"><div class="loading-spinner"></div>Carregando...</div></div>
  </div>
  
  <div class="ajuda-container" id="telaAjuda">
    <button class="voltar-btn" onclick="voltarInicio()">‚Üê Voltar</button>
    <h2 class="titulo-secao">D√∫vidas</h2>
    <div class="topico-ajuda"><h3>üìÖ Hor√°rios</h3><p>Consulte a agenda dispon√≠vel.</p></div>
    <div class="topico-ajuda"><h3>üîÑ Cancelamentos</h3><p>Cancele com at√© 2 horas de anteced√™ncia.</p></div>
    <div class="topico-ajuda"><h3>üìç Localiza√ß√£o</h3><p>Rua das Flores, 123 - Centro, SP.</p></div>
    <div class="topico-ajuda"><h3>üì± Contato</h3><p>Esqueceu algo? Ligue: (11) 3333-4444</p></div>
  </div>
  
  <div class="admin-container" id="telaAdmin">
    <button class="voltar-btn" onclick="sairAdmin()">‚Üê Sair do ADM</button>
    <h2 class="titulo-secao">‚öôÔ∏è √Årea Administrativa</h2>
    
    <div style="margin-bottom: 30px;">
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
    <h3 style="color: #475569; font-size: 18px; margin: 0;">üìã Agendamentos</h3>
    <span onclick="toggleLista()" style="cursor: pointer; font-size: 22px; color: #3b82f6; font-weight: bold;" id="triangulo">‚ñº</span>
  </div>
  <div class="lista-agendamentos-admin" id="todosAgendamentos" style="display: block;">
    <div class="loading"><div class="loading-spinner"></div>Carregando...</div>
  </div>
</div>
  
    <div class="form-admin">
      <h3 style="color: #475569; margin-bottom: 20px;">‚úÖ Marcar como Conclu√≠do</h3>
      <div class="grid-admin">
        <div class="form-group"><label class="form-label">Selecione</label><select class="form-input" id="selectAgendamento"><option>Carregando...</option></select></div>
      </div>
      <div id="detalhesAgendamento" style="display: none; background: #f0f9ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div><strong>Cliente:</strong> <span id="detNome">-</span></div>
          <div><strong>Telefone:</strong> <span id="detTelefone">-</span></div>
          <div><strong>Servi√ßo:</strong> <span id="detServico">-</span></div>
          <div><strong>Profissional:</strong> <span id="detProfissional">-</span></div>
          <div><strong>Hor√°rio:</strong> <span id="detHorario">-</span></div>
          <div><strong>C√≥digo:</strong> <span id="detCodigo">-</span></div>
        </div>
      </div>
      <button class="btn-admin" onclick="marcarConcluido()" style="background: #10b981;">‚úîÔ∏è Marcar como Conclu√≠do</button>
    </div>
    
    <div class="cadastro-servico">
      <h3 style="color: #475569; margin-bottom: 20px;">üìà Gerenciar Servi√ßos</h3>
      <div class="grid-servico">
        <div class="form-group"><label class="form-label">Servi√ßo</label><input type="text" class="form-input" id="editarServicoNome" placeholder="Nome do servi√ßo"></div>
        <div class="form-group"><label class="form-label">Pre√ßo (R$)</label><input type="number" class="form-input" id="editarServicoPreco" placeholder="30.00" step="0.01"></div>
        <div class="form-group"><label class="form-label">Profissional</label><input type="text" class="form-input" id="editarServicoProfissional" placeholder="Jo√£o"></div>
        <div class="form-group"><label class="form-label">Descri√ß√£o</label><input type="text" class="form-input" id="editarServicoDescricao" placeholder="M√°x 40 caracteres" maxlength="40"></div>
        <div class="form-group"><label class="form-label">Tempo (min)</label><select class="form-input" id="editarServicoTempo"><option value="30">30</option><option value="45">45</option><option value="60">60</option><option value="90">90</option></select></div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
        <button class="btn-admin" onclick="adicionarServico()" style="background: #ec4899;">‚ûï Adicionar</button>
        <button class="btn-admin" onclick="atualizarServico()" style="background: #3b82f6;">‚úèÔ∏è Atualizar</button>
      </div>
      <button class="btn-admin" onclick="excluirServico()" style="background: #ef4444; margin-top: 15px;">üóëÔ∏è Excluir Selecionado</button>
    </div>
    
    <div class="config-horarios">
      <div class="config-box">
        <h3 style="color: #475569; margin-bottom: 15px;">üçΩÔ∏è Hor√°rio de Almo√ßo</h3>
        <div class="form-group"><label class="form-label">In√≠cio</label><input type="time" class="form-input" id="almocoInicio" value="12:00"></div>
        <div class="form-group"><label class="form-label">Fim</label><input type="time" class="form-input" id="almocoFim" value="13:00"></div>
        <button class="btn-admin" onclick="salvarConfiguracao('almoco')" style="background: #f59e0b;">üíæ Salvar Almo√ßo</button>
      </div>
      <div class="config-box">
        <h3 style="color: #475569; margin-bottom: 15px;">üèñÔ∏è Marcar Folga</h3>
        <div class="form-group"><label class="form-label">Data</label><input type="date" class="form-input" id="dataFolga"></div>
        <div class="form-group"><label class="form-label">Motivo</label><input type="text" class="form-input" id="motivoFolga" placeholder="Feriado"></div> 
        <div style="display: flex; gap: 10px;">
        <button class="btn-admin" onclick="adicionarFolga()" style="background: #8b5cf6;">üèñÔ∏è Salvar Folga</button>
        <button class="btn-admin" onclick="excluirFolgaPelaData()" style="background: #ef4444;">üóëÔ∏è Excluir</button>
      </div>
      </div>
    </div>
    
    <div style="margin-top: 30px;">
      <h3 style="color: #475569; margin-bottom: 15px; font-size: 18px;">üìã Servi√ßos Cadastrados (Clique para editar)</h3>
      <div id="listaServicosAdmin"><div class="loading"><div class="loading-spinner"></div>Carregando...</div></div>
    </div>
  </div>
  
  <div class="pdf-container" id="telaPDF">
    <button class="voltar-btn" onclick="voltarInicio()">‚Üê Voltar</button>
    <div class="ticket-agendamento">
      <div style="text-align: center; border-bottom: 3px solid #3b82f6; padding-bottom: 20px; margin-bottom: 25px;">
        <h2 style="color: #1e293b; margin-bottom: 10px;">‚úÇÔ∏è Barbearia Jo√£o</h2>
        <p style="color: #64748b;">Comprovante de Agendamento</p>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;"><strong style="color: #64748b; display: block; font-size: 14px;">Cliente</strong><span id="pdfCliente" style="color: #1e293b; font-weight: 600;"></span></div>
        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;"><strong style="color: #64748b; display: block; font-size: 14px;">Telefone</strong><span id="pdfTelefone" style="color: #1e293b; font-weight: 600;"></span></div>
        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;"><strong style="color: #64748b; display: block; font-size: 14px;">Servi√ßo</strong><span id="pdfServico" style="color: #1e293b; font-weight: 600;"></span></div>
        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;"><strong style="color: #64748b; display: block; font-size: 14px;">Profissional</strong><span id="pdfProfissional" style="color: #1e293b; font-weight: 600;"></span></div>
        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;"><strong style="color: #64748b; display: block; font-size: 14px;">Valor</strong><span id="pdfValor" style="color: #1e293b; font-weight: 600;"></span></div>
        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;"><strong style="color: #64748b; display: block; font-size: 14px;">Data/Hor√°rio</strong><span id="pdfData" style="color: #1e293b; font-weight: 600;"></span></div>
      </div>
      <div style="text-align: center; padding: 20px; background: #f1f5f9; border-radius: 10px; margin-bottom: 25px;">
        <p style="color: #1e293b; font-weight: 600; margin-bottom: 10px;">C√≥digo</p>
        <p style="font-size: 24px; color: #3b82f6; font-weight: 700; letter-spacing: 3px;" id="pdfCodigo"></p>
        <p style="color: #64748b; font-size: 14px; margin-top: 10px;">Apresente este c√≥digo</p>
      </div>
      <button class="btn-admin" onclick="imprimirComprovante()" style="background: #1e293b;">üñ®Ô∏è Imprimir</button>
    </div>
  </div>
</div>

<div class="barra-inferior">
  <button class="btn-nav" onclick="voltarInicio()">üè† In√≠cio</button>
  <button class="btn-nav" onclick="mostrarCalendario()">üìÖ Agendar</button>
  <button class="btn-nav" onclick="mostrarAreaCliente()">üë§ Agenda</button>
  <button class="btn-nav" onclick="mostrarAjuda()">‚ùì D√∫vidas</button>
  <button class="btn-nav" onclick="mostrarLoginAdmin()" id="btnAdmin">‚öôÔ∏è ADM</button>
</div>

<div class="login-admin" id="telaLoginAdmin">
  <div class="modal-admin">
    <h2 style="text-align: center; margin-bottom: 25px; color: #1e293b;">üîê Acesso Administrativo</h2>
    <div class="form-group"><label class="form-label">C√≥digo Secreto</label><input type="password" class="form-input" id="codigoAdmin" placeholder="Digite o c√≥digo" onkeypress="if(event.key == 'Enter') entrarAdmin()"></div>
    <div class="form-group"><label><input type="checkbox" id="manterConectado"> Manter conectado (30 dias)</label></div>
    <button class="btn-admin" onclick="entrarAdmin()">üîë Entrar</button>
    <button class="voltar-btn" onclick="fecharLoginAdmin()" style="width: 100%; text-align: center; margin-top: 15px;">Cancelar</button>
  </div>
</div>

<script>
const SUPABASE_URL = 'https://epcbuzoyhoksyqgtruyr.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVwY2J1em95aG9rc3lxZ3RydXlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMDM2MjgsImV4cCI6MjA4NTg3OTYyOH0.0EJEG5n06RJSrXfNzbkR7LVgtUSppScogSLmGYRclD0';

async function fetchSupabase(endpoint, options = {}) {
  const url = `${SUPABASE_URL}/rest/v1/${endpoint}`;
  
  const headers = {
    'apikey': SUPABASE_KEY,
    'Authorization': `Bearer ${SUPABASE_KEY}`,
    'Content-Type': 'application/json'
  };
  
  const adminSenha = localStorage.getItem('admin_senha');
  if (adminSenha) {
    headers['X-Admin-Password'] = adminSenha;
  }//admin
  
  if (options.method === 'POST' || options.method === 'PATCH') {
    headers['Prefer'] = 'return=representation';
  }
  
  try {
    const response = await fetch(url, {
      ...options,
      headers: headers,
      mode: 'cors',
      credentials: 'omit'
    });
    
    if (!response.ok) {
      const errorText = await response.text();
      console.error('Erro Supabase:', response.status, errorText);
      throw new Error(`Supabase error ${response.status}`);
    }
    
    if (response.status === 204) return null;
    
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      return await response.json();
    }
    
    return null;
  } catch (error) {
    console.error('Erro de conex√£o:', error);
    throw error;
  }
}

let telaAtual = 'inicio';
let mesAtual = new Date().getMonth();
let anoAtual = new Date().getFullYear();
let dataSelecionada = null;
let horarioSelecionado = null;
let servicoSelecionado = null;
let profissionalSelecionado = null;
let servicos = [];
let agendamentos = [];
let configuracoes = {};
let folgas = [];
let servicoEditando = null;
let clientesCache = {};
let verAgendamento = true;
let temNovoAgendamento = false;
let agendamentosVistos = 0;
  
async function carregarServicos() {
  try {
    servicos = await fetchSupabase('servicos?select=*&order=nome.asc');
    return servicos;
  } catch (error) {
    console.error('Erro ao carregar servi√ßos:', error);
    return [];
  }
}

async function carregarAgendamentos() {
  try {
    agendamentos = await fetchSupabase('agenda?select=*&order=data_agendamento.desc,horario.desc');
    return agendamentos;
  } catch (error) {
    console.error('Erro ao carregar agendamentos:', error);
    return [];
  }
}

async function carregarClientes() {
  try {
    const clientes = await fetchSupabase('clientes?select=*');
    clientesCache = {};
    clientes.forEach(cliente => {
      clientesCache[cliente.id] = cliente;
    });
    return clientesCache;
  } catch (error) {
    console.error('Erro ao carregar clientes:', error);
    return {};
  }
}

async function carregarConfiguracoes() {
  try {
    const dados = await fetchSupabase('configuracoes?select=*');
    configuracoes = {};
    dados.forEach(item => {
      configuracoes[item.chave] = item.valor;
    });
    return configuracoes;
  } catch (error) {
    console.error('Erro ao carregar configura√ß√µes:', error);
    return {};
  }
}

async function carregarFolgas() {
  try {
    folgas = await fetchSupabase('folgas?select=*&order=data_folga.asc');
    return folgas;
  } catch (error) {
    console.error('Erro ao carregar folgas:', error);
    return [];
  }
}

function toggleLista() {
  const container = document.getElementById('todosAgendamentos');
  const triangulo = document.getElementById('triangulo');

  const estaOculto = container.style.display === 'none';

  if (estaOculto) {
    container.style.display = 'block';
    triangulo.innerHTML = '‚ñº';
  } else {
    container.style.display = 'none';
    triangulo.innerHTML = '‚ñ∂';
  }
}

  
async function adicionarServico() {
  const nome = document.getElementById('editarServicoNome').value.trim();
  const preco = parseFloat(document.getElementById('editarServicoPreco').value);
  const profissional = document.getElementById('editarServicoProfissional').value.trim();
  const descricao = document.getElementById('editarServicoDescricao').value.trim().substring(0, 40);
  const tempo = parseInt(document.getElementById('editarServicoTempo').value);
  
  if (!nome || !preco || !profissional || !tempo) {
    mostrarMensagem('Preencha todos os campos!', 'erro');
    return;
  }
  
  try {
    const novoServico = {
      nome: nome,
      preco: preco,
      profissional: profissional,
      descricao: descricao || null,
      tempo_minutos: tempo,
      ativo: true
    };
    
    await fetchSupabase('servicos', {
      method: 'POST',
      body: JSON.stringify(novoServico)
    });
    
    mostrarMensagem('Servi√ßo adicionado!', 'sucesso');
    await carregarServicos();
    carregarServicosCliente();
    carregarServicosAdmin();
    
    document.getElementById('editarServicoNome').value = '';
    document.getElementById('editarServicoPreco').value = '';
    
  } catch (error) {
    mostrarMensagem('Erro ao adicionar servi√ßo', 'erro');
  }
}

async function atualizarServico() {
  if (!servicoEditando) {
    mostrarMensagem('Selecione um servi√ßo para editar!', 'erro');
    return;
  }
  
  const nome = document.getElementById('editarServicoNome').value.trim();
  const preco = parseFloat(document.getElementById('editarServicoPreco').value);
  const profissional = document.getElementById('editarServicoProfissional').value.trim();
  const descricao = document.getElementById('editarServicoDescricao').value.trim().substring(0, 40);
  const tempo = parseInt(document.getElementById('editarServicoTempo').value);
  
  if (!nome || !preco || !profissional || !tempo) {
    mostrarMensagem('Preencha todos os campos!', 'erro');
    return;
  }
  
  try {
    const servicoAtualizado = {
      nome: nome,
      preco: preco,
      profissional: profissional,
      descricao: descricao,
      tempo_minutos: tempo
    };
    
   await fetchSupabase(`servicos?id=eq.${servicoEditando.id}`, {
      method: 'PATCH',
      body: JSON.stringify(servicoAtualizado)
    });
    
    mostrarMensagem('Servi√ßo atualizado!', 'sucesso');
    await carregarServicos();
    carregarServicosCliente();
    carregarServicosAdmin();
    
    servicoEditando = null;
    
  } catch (error) {
    mostrarMensagem('Erro ao atualizar servi√ßo', 'erro');
  }
}

async function excluirServico() {
  if (!servicoEditando) {
    mostrarMensagem('Selecione um servi√ßo para excluir!', 'erro');
    return;
  }
  
  if (!confirm(`Excluir servi√ßo "${servicoEditando.nome}"?`)) return;
  
  try {
    await fetchSupabase(`servicos?id=eq.${servicoEditando.id}`, {
      method: 'DELETE'
    });
  
    mostrarMensagem('Servi√ßo exclu√≠do!', 'sucesso');
    await carregarServicos();
    carregarServicosCliente();
    carregarServicosAdmin();
    
    document.getElementById('editarServicoNome').value = '';
    document.getElementById('editarServicoPreco').value = '';
    servicoEditando = null;
    
  } catch (error) {
    mostrarMensagem('Erro ao excluir servi√ßo', 'erro');
  }
}

async function salvarConfiguracao(tipo) {
  try {
    if (tipo === 'almoco') {
      const inicio = document.getElementById('almocoInicio').value;
      const fim = document.getElementById('almocoFim').value;
      
      await fetchSupabase(`configuracoes?chave=eq.horario_almoco_inicio`, {
        method: 'PATCH',
        body: JSON.stringify({ valor: inicio })
      });
      
      await fetchSupabase(`configuracoes?chave=eq.horario_almoco_fim`, {
        method: 'PATCH',
        body: JSON.stringify({ valor: fim })
      });
      
      mostrarMensagem('Hor√°rio salvo!', 'sucesso');
    }
  } catch (error) {
    mostrarMensagem('Erro ao salvar', 'erro');
  }
}

async function adicionarFolga() {
  const data = document.getElementById('dataFolga').value;
  const motivo = document.getElementById('motivoFolga').value;
  
  if (!data) {
    mostrarMensagem('Selecione uma data!', 'erro');
    return;
  }
  
  try {
    const novaFolga = {
      data_folga: data,
      motivo: motivo || 'Folga'
    };
    
    await fetchSupabase('folgas', {
      method: 'POST',
      body: JSON.stringify(novaFolga)
    });
    
    mostrarMensagem('Folga salva!', 'sucesso');
    await carregarFolgas();
    
    document.getElementById('dataFolga').value = '';
    document.getElementById('motivoFolga').value = '';
    
  } catch (error) {
    mostrarMensagem('Erro ao salvar folga', 'erro');
  }
}

function mostrarTela(tela) {
  document.querySelectorAll('.container-principal > div').forEach(el => {
    el.style.display = 'none';
  });
  telaAtual = tela;
  if (tela === 'inicio') document.getElementById('telaInicial').style.display = 'flex';
  else if (tela === 'servicos') { document.getElementById('telaServicos').style.display = 'block'; carregarServicosCliente(); }
  else if (tela === 'calendario') { document.getElementById('telaCalendario').style.display = 'block'; gerarCalendario(); }
  else if (tela === 'profissionais') { document.getElementById('telaProfissionais').style.display = 'block'; carregarProfissionais(); }
  else if (tela === 'horarios') { document.getElementById('telaHorarios').style.display = 'block'; carregarHorarios(); }
  else if (tela === 'formulario') document.getElementById('telaFormulario').style.display = 'block';
  else if (tela === 'cliente') { document.getElementById('telaCliente').style.display = 'block'; carregarAgendaCliente(); }
  else if (tela === 'ajuda') document.getElementById('telaAjuda').style.display = 'block';
  else if (tela === 'admin') { document.getElementById('telaAdmin').style.display = 'block'; carregarAdmin(); }
  else if (tela === 'pdf') document.getElementById('telaPDF').style.display = 'block';
}

function voltarInicio() { mostrarTela('inicio'); }
function mostrarServicos() { mostrarTela('servicos'); }
function mostrarCalendario() { mostrarTela('calendario'); }
function mostrarProfissionais() { mostrarTela('profissionais'); }
function mostrarHorarios() { mostrarTela('horarios'); }
function mostrarAreaCliente() { mostrarTela('cliente'); }
function mostrarAjuda() { mostrarTela('ajuda'); }

async function carregarServicosCliente() {
  const container = document.getElementById('listaServicosCliente');
  container.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Carregando...</div>';
  
  try {
    await carregarServicos();
    
    if (servicos.length === 0) {
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;">üíà<br><h3>Nenhum servi√ßo</h3></div>';
      return;
    }
    
    let html = '';
    servicos.forEach(servico => {
html += `
<div class="card-servico" style="border-left:8px solid #3b82f6;border-radius:22px;padding:18px;margin-bottom:22px;box-shadow:0 14px 34px -10px rgba(0,0,0,0.12);display:grid;grid-template-columns:1fr 1fr;gap:16px;width:100%;background:linear-gradient(145deg,#fff,#f8fafc);">

<div style="grid-column:1/-1;font-size:18px;font-weight:700;color:#0f172a;display:flex;align-items:center;gap:8px;">üíÜ ${servico.nome}</div>

${servico.descricao ? `<div style="grid-column:1/-1;font-size:13px;color:#475569;line-height:1.5;background:rgba(0,0,0,0.03);padding:12px;border-radius:12px;">${servico.descricao}</div>` : ""}

<div style="background:rgba(16,185,129,0.08);border-radius:16px;padding:14px;text-align:center;">
<div style="font-size:12px;font-weight:600;color:#059669;">üí∞ PRE√áO</div>
<div style="margin-top:4px;font-size:16px;font-weight:800;color:#10b981;">R$ ${servico.preco.toFixed(2)}</div>
</div>

<div style="background:rgba(59,130,246,0.08);border-radius:16px;padding:14px;text-align:center;">
<div style="font-size:12px;font-weight:600;color:#2563eb;">‚è±Ô∏è TEMPO</div>
<div style="margin-top:4px;font-size:15px;font-weight:700;color:#1e40af;">${servico.tempo_minutos} min</div>
</div>

<div style="grid-column:1/-1;background:#f1f5f9;border-radius:16px;padding:14px;text-align:center;">
<div style="font-size:12px;font-weight:600;color:#64748b;">üë§ ATENDIDO POR</div>
<div style="margin-top:4px;font-size:15px;font-weight:700;color:#0f172a;">${servico.profissional}</div>
</div>

</div>
`;

    });
    
    container.innerHTML = html;
  } catch (error) {
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">‚ö†Ô∏è<br><h3>Erro ao carregar</h3></div>';
  }
}

function gerarCalendario() {
  const meses = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
  document.getElementById('mesAtual').textContent = `${meses[mesAtual]} ${anoAtual}`;
  
  const primeiroDia = new Date(anoAtual, mesAtual, 1);
  const ultimoDia = new Date(anoAtual, mesAtual + 1, 0);
  const diaInicio = primeiroDia.getDay();
  
  let html = '';
  for (let i = 0; i < diaInicio; i++) {
    html += '<div class="dia desabilitado"></div>';
  }
  
const hoje = new Date();
const hojeLocal = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
const hojeFormatado = `${hojeLocal.getFullYear()}-${String(hojeLocal.getMonth() + 1).padStart(2, '0')}-${String(hojeLocal.getDate()).padStart(2, '0')}`;
  
for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
  const dataStr = `${anoAtual}-${String(mesAtual + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
    
  const dataObj = new Date(anoAtual, mesAtual, dia);
  dataObj.setHours(0,0,0,0);
  
  const hojeObj = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
  hojeObj.setHours(0,0,0,0);
    
  const eHoje = dataObj.getTime() === hojeObj.getTime();
  const ePassado = dataObj.getTime() < hojeObj.getTime();
  const eSelecionado = dataStr === dataSelecionada;
    
    let eFeriado = false;
    if (folgas && folgas.length > 0) {
      eFeriado = folgas.some(f => f.data_folga === dataStr);
    }
    
    let classes = 'dia';
    if (eHoje) classes += ' hoje';
    if (eSelecionado) classes += ' selecionado';
    if (ePassado || eFeriado) classes += ' desabilitado';
    if (eFeriado) classes += ' feriado';
    
    const podeClicar = !ePassado && !eFeriado;
    
    html += `<div class="${classes}" ${podeClicar ? `onclick="selecionarData('${dataStr}')"` : ''}>
      ${dia}
      ${eFeriado ? 'üèñÔ∏è' : ''}
    </div>`;
  }
  
  document.getElementById('gradeDias').innerHTML = html;
  
}

function mesAnterior() { 
  mesAtual--; 
  if (mesAtual < 0) { 
    mesAtual = 11; 
    anoAtual--; 
  } 
  gerarCalendario(); 
}

function proximoMes() { 
  if (anoAtual === 2027 && mesAtual === 11) {
    return;
  }
  
  mesAtual++; 
  if (mesAtual > 11) { 
    mesAtual = 0; 
    anoAtual++; 
  } 
  gerarCalendario(); 
}
  
function selecionarData(data) {
  dataSelecionada = data;
  
  const [ano, mes, dia] = data.split('-').map(Number);
  const dataObj = new Date(ano, mes - 1, dia);
  
  const opcoes = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
  const dataFormatada = dataObj.toLocaleDateString('pt-BR', opcoes);
  document.getElementById('dataSelecionada').textContent = dataFormatada.charAt(0).toUpperCase() + dataFormatada.slice(1);
  
  gerarCalendario();
  mostrarTela('profissionais');
}

async function carregarProfissionais() {
  const container = document.getElementById('listaProfissionais');
  container.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Carregando...</div>';
  
  if (!dataSelecionada) {
    mostrarMensagem('Selecione uma data!', 'erro');
    mostrarTela('calendario');
    return;
  }
  
  try {
    await carregarServicos();
    await carregarFolgas();
    
    const eFolga = folgas.some(f => f.data_folga === dataSelecionada);
    if (eFolga) {
      const motivo = folgas.find(f => f.data_folga === dataSelecionada)?.motivo || 'Folga';
      container.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #ef4444;">
          üèñÔ∏è<br>
          <h3>${motivo}</h3>
          <p>N√£o h√° atendimento nesta data</p>
          <button class="btn-limpar" onclick="mostrarCalendario()" style="margin-top: 20px;">Escolher outra data</button>
        </div>
      `;
      return;
    }
    
    const profissionaisUnicos = [...new Set(servicos.map(s => s.profissional))];
    
    if (profissionaisUnicos.length === 0) {
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">üë®‚Äçüíº<br><h3>Nenhum profissional</h3></div>';
      return;
    }
    
    let html = '';
    profissionaisUnicos.forEach(profissional => {
      const servicosDoProfissional = servicos.filter(s => s.profissional === profissional);
      const servicosLista = servicosDoProfissional.map(s => 
        `<div style="margin-bottom: 5px;"><strong>${s.nome}</strong> - ${s.tempo_minutos}min (R$ ${s.preco.toFixed(2)})</div>`
      ).join('');
      
      html += `
        <div class="profissional-item" onclick="selecionarProfissional('${profissional}')">
          <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div style="flex: 1;">
              <h3 style="font-size: 18px; margin-bottom: 10px; color: #1e293b;">üë®‚Äçüíº ${profissional}</h3>
              <div style="color: #64748b; font-size: 14px;">
                ${servicosLista}
              </div>
            </div>
            <div style="color: #3b82f6; font-size: 24px; margin-left: 15px;">‚Üí</div>
          </div>
        </div>
      `;
    });
    
    container.innerHTML = html;
  } catch (error) {
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">‚ö†Ô∏è<br><h3>Erro</h3></div>';
  }
}

function selecionarProfissional(profissional) {
  profissionalSelecionado = profissional;
  document.querySelectorAll('.profissional-item').forEach(item => item.classList.remove('selecionado'));
  event.currentTarget.classList.add('selecionado');
  document.getElementById('profissionalSelecionadoNome').textContent = profissional;
  selecionarServicoDoProfissional();
}

function selecionarServicoDoProfissional() {
  const servicosDoProfissional = servicos.filter(s => s.profissional === profissionalSelecionado);
  
  let html = '<h2 class="titulo-secao">Escolha o servi√ßo</h2>';
  servicosDoProfissional.forEach(servico => {
    html += `
      <div class="horario-item" onclick="finalizarSelecaoServico('${servico.id}')" style="text-align: left; display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
        <div>
          <div style="font-weight: 700; color: #1e293b;">${servico.nome}</div>
          <div style="color: #64748b; font-size: 14px;">‚è±Ô∏è ${servico.tempo_minutos} minutos</div>
        </div>
        <div style="color: #10b981; font-weight: 700;">R$ ${servico.preco.toFixed(2)}</div>
      </div>
    `;
  });
  
  document.getElementById('listaHorarios').innerHTML = html;
  mostrarTela('horarios');
}

async function carregarHorarios() {
  const container = document.getElementById('listaHorarios');
  container.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Carregando...</div>';
  
  if (!dataSelecionada || !profissionalSelecionado) {
    mostrarMensagem('Selecione profissional e servi√ßo!', 'erro');
    mostrarTela('profissionais');
    return;
  }
  
  try {
    await Promise.all([carregarAgendamentos(), carregarConfiguracoes(), carregarFolgas()]);
    
    const eFolga = folgas.some(f => f.data_folga === dataSelecionada);
    if (eFolga) {
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">üèñÔ∏è<br><h3>Folga</h3><p>Escolha outra data</p></div>';
      return;
    }
    
    const servicosDoProfissional = servicos.filter(s => s.profissional === profissionalSelecionado);
    
    let html = '<h2 class="titulo-secao">Escolha o servi√ßo primeiro</h2>';
    servicosDoProfissional.forEach(servico => {
      html += `
        <div class="horario-item" onclick="selecionarServicoEHorario('${servico.id}')" style="text-align: left; display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
          <div>
            <div style="font-weight: 700; color: #1e293b;">${servico.nome}</div>
            <div style="color: #64748b; font-size: 14px;">‚è±Ô∏è ${servico.tempo_minutos} minutos</div>
          </div>
          <div style="color: #10b981; font-weight: 700;">R$ ${servico.preco.toFixed(2)}</div>
        </div>
      `;
    });
    
    container.innerHTML = html;
  } catch (error) {
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">‚ö†Ô∏è<br><h3>Erro</h3></div>';
  }
}

function selecionarServicoEHorario(servicoId) {
  servicoSelecionado = servicos.find(s => s.id === servicoId);
  if (!servicoSelecionado) { mostrarMensagem('Servi√ßo n√£o encontrado', 'erro'); return; }
  
  mostrarHorariosDisponiveis();
}

async function mostrarHorariosDisponiveis() {
  const container = document.getElementById('listaHorarios');
  container.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Carregando...</div>';
  
  try {
    const duracaoServico = servicoSelecionado.tempo_minutos;
    
    const horarios = [];
    const inicio = configuracoes.horario_abertura || '09:00';
    const fim = configuracoes.horario_fechamento || '19:00';
    const almocoInicio = configuracoes.horario_almoco_inicio || '12:00';
    const almocoFim = configuracoes.horario_almoco_fim || '13:00';
    
    let horaAtual = new Date(`2000-01-01T${inicio}`);
    const horaFim = new Date(`2000-01-01T${fim}`);
    
    while (horaAtual < horaFim) {
      const horarioInicio = horaAtual.toTimeString().slice(0, 5);
      const horarioFim = new Date(horaAtual.getTime() + duracaoServico * 60000).toTimeString().slice(0, 5);
      
      if (new Date(`2000-01-01T${horarioFim}`) > horaFim) {
        horaAtual.setMinutes(horaAtual.getMinutes() + 30);
        continue;
      }
      
      const conflitaAlmoco = (
        (horarioInicio >= almocoInicio && horarioInicio < almocoFim) ||
        (horarioFim > almocoInicio && horarioFim <= almocoFim) ||
        (horarioInicio <= almocoInicio && horarioFim >= almocoFim)
      );
      
      let conflitoAgendamento = false;
      
      for (const ag of agendamentos) {
        if (ag.data_agendamento !== dataSelecionada || ag.status !== 'confirmado') continue;
        
        const servicoAgendado = servicos.find(s => s.id === ag.servico_id);
        if (!servicoAgendado) continue;
        
        if (servicoAgendado.profissional !== profissionalSelecionado) continue;
        
        const agInicio = new Date(`2000-01-01T${ag.horario}`);
        const agDuracao = ag.duracao_minutos || 30;
        const agFim = new Date(agInicio.getTime() + agDuracao * 60000);
        
        const meuInicio = new Date(`2000-01-01T${horarioInicio}`);
        const meuFim = new Date(`2000-01-01T${horarioFim}`);
        
        if ((meuInicio >= agInicio && meuInicio < agFim) ||
            (meuFim > agInicio && meuFim <= agFim) ||
            (meuInicio <= agInicio && meuFim >= agFim)) {
          conflitoAgendamento = true;
          break;
        }
      }
      
      const hoje = new Date();
      const hojeFormatado = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}-${String(hoje.getDate()).padStart(2, '0')}`;
      const eHoje = dataSelecionada === hojeFormatado;
      //const horarioPassado = eHoje && new Date(`2000-01-01T${horarioInicio}`) < new Date();
const horarioPassado = eHoje && horarioInicio <= new Date().toTimeString().slice(0,5);
      const disponivel = !conflitaAlmoco && !conflitoAgendamento && !horarioPassado;
      
      horarios.push({
        inicio: horarioInicio,
        fim: horarioFim,
        disponivel: disponivel,
        motivo: conflitaAlmoco ? 'Almo√ßo' : conflitoAgendamento ? 'Ocupado' : horarioPassado ? 'Passado' : 'Dispon√≠vel'
      });
      
      horaAtual.setMinutes(horaAtual.getMinutes() + 30);
    }
    
    let html = '<h2 class="titulo-secao">Hor√°rios dispon√≠veis</h2>';
    html += `<p style="margin-bottom: 20px; color: #64748b;">Servi√ßo: <strong>${servicoSelecionado.nome}</strong> (${duracaoServico}min)</p>`;
    
    if (horarios.length === 0) {
      html += '<div style="text-align: center; padding: 40px; color: #64748b;">‚è∞<br><h3>Nenhum hor√°rio</h3></div>';
    } else {
      horarios.forEach(item => {
        const eSelecionado = item.inicio === horarioSelecionado;
        let classes = 'horario-item';
        if (eSelecionado) classes += ' selecionado';
        if (!item.disponivel) classes += ' indisponivel';
        
        html += `<div class="${classes}" ${item.disponivel ? `onclick="selecionarHorario('${item.inicio}', '${item.fim}')"` : ''} title="${item.motivo}">
          ${item.inicio} - ${item.fim} (${duracaoServico}min)
          ${!item.disponivel ? `<small style="display:block;font-size:12px;color:#dc2626;">${item.motivo}</small>` : ''}
        </div>`;
      });
    }
    
    container.innerHTML = html;
  } catch (error) {
    console.error(error);
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;">‚ö†Ô∏è<br><h3>Erro</h3></div>';
  }
}

function selecionarHorario(inicio, fim) {
  horarioSelecionado = inicio;
  document.querySelectorAll('.horario-item').forEach(item => item.classList.remove('selecionado'));
  event.target.classList.add('selecionado');
  
  const [ano, mes, dia] = dataSelecionada.split('-').map(Number);
  const dataObj = new Date(ano, mes - 1, dia);
  const dataFormatada = dataObj.toLocaleDateString('pt-BR');
  document.getElementById('resumoProfissional').textContent = profissionalSelecionado;
  document.getElementById('resumoServico').textContent = servicoSelecionado.nome;
  document.getElementById('resumoData').textContent = dataFormatada;
  document.getElementById('resumoHorario').textContent = `${inicio} - ${fim}`;
  document.getElementById('resumoDuracao').textContent = `${servicoSelecionado.tempo_minutos} minutos`;
  document.getElementById('resumoValor').textContent = `R$ ${servicoSelecionado.preco.toFixed(2)}`;
  
  setTimeout(() => mostrarTela('formulario'), 500);
}

function finalizarSelecaoServico(servicoId) {
  servicoSelecionado = servicos.find(s => s.id === servicoId);
  if (!servicoSelecionado) { mostrarMensagem('Servi√ßo n√£o encontrado', 'erro'); return; }
  
  mostrarHorariosDisponiveis();
}

async function confirmarAgendamento() {
  const nome = document.getElementById('nomeCliente').value.trim();
  const telefone = document.getElementById('telefoneCliente').value.trim();
  
  if (!nome || !telefone || !dataSelecionada || !horarioSelecionado || !servicoSelecionado || !profissionalSelecionado) {
    mostrarMensagem('Preencha todos os campos!', 'erro');
    return;
  }
  
  try {
    const clienteData = {
      nome: nome,
      telefone: telefone,
      codigo_secreto: 'cli_' + Date.now()
    };
    
    const clienteResult = await fetchSupabase('clientes', {
      method: 'POST',
      body: JSON.stringify(clienteData)
    });
    
    const clienteId = clienteResult[0].id;
    
    const agendamentoData = {
      cliente_id: clienteId,
      servico_id: servicoSelecionado.id,
      data_agendamento: dataSelecionada,
      horario: horarioSelecionado,
      status: 'confirmado',
      valor: servicoSelecionado.preco,
      duracao_minutos: servicoSelecionado.tempo_minutos,
      codigo_confirmacao: Math.random().toString(36).substring(2, 10).toUpperCase()
    };
    
    await fetchSupabase('agenda', {
      method: 'POST',
      body: JSON.stringify(agendamentoData)
    });
    

// üî• PEGAR O ID QUE O BANCO GEROU!
const agendamentos = await fetchSupabase('agenda?select=id&order=created_at.desc&limit=1');
const agendamentoId = agendamentos[0].id; 

localStorage.setItem('cliente_telefone', telefone);

const comprovante = {
  id: agendamentoId, // ‚úÖ AGORA √â O ID DO BANCO!
  cliente: nome,
  telefone: telefone,
  servico: servicoSelecionado.nome,
  profissional: profissionalSelecionado,
  data: dataSelecionada,
  horario: horarioSelecionado,
  valor: servicoSelecionado.preco,
  codigo: agendamentoData.codigo_confirmacao, // ‚úÖ "G1WTGS74" vai aqui
  status: 'confirmado'
};

let comprovantes = localStorage.getItem('todos_comprovantes');
if (comprovantes) {
  comprovantes = JSON.parse(comprovantes);
} else {
  comprovantes = [];
}
comprovantes.unshift(comprovante); // adiciona no in√≠cio
localStorage.setItem('todos_comprovantes', JSON.stringify(comprovantes));
    
    const [ano, mes, dia] = dataSelecionada.split('-').map(Number);
    const dataObj = new Date(ano, mes - 1, dia);
    const dataFormatada = dataObj.toLocaleDateString('pt-BR');
    document.getElementById('pdfCliente').textContent = nome;
    document.getElementById('pdfTelefone').textContent = telefone;
    document.getElementById('pdfServico').textContent = servicoSelecionado.nome;
    document.getElementById('pdfProfissional').textContent = profissionalSelecionado;
    document.getElementById('pdfValor').textContent = `R$ ${servicoSelecionado.preco.toFixed(2)}`;
    document.getElementById('pdfData').textContent = `${dataFormatada} - ${horarioSelecionado}`;
    document.getElementById('pdfCodigo').textContent = agendamentoData.codigo_confirmacao;
    
    mostrarMensagem('Agendamento salvo! ‚úÖ', 'sucesso');
    document.getElementById('nomeCliente').value = '';
    document.getElementById('telefoneCliente').value = '';
    
    setTimeout(() => mostrarTela('pdf'), 1000);
    
  } catch (error) {
    mostrarMensagem('Erro ao salvar agendamento', 'erro');
  }
}



async function carregarAgendaCliente() {
  const container = document.getElementById('listaAgendaCliente');
  container.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Carregando...</div>';
  
  try {
    const comprovantes = localStorage.getItem('todos_comprovantes');
    
    if (!comprovantes || JSON.parse(comprovantes).length === 0) {
      container.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #64748b;">
          üì±<br>
          <h3>Fa√ßa um agendamento primeiro</h3>
          <p>Seus agendamentos aparecer√£o aqui automaticamente</p>
          <button class="btn-limpar" onclick="mostrarCalendario()" style="margin-top: 20px; background: #3b82f6; color: white; border: none; padding: 12px 24px; border-radius: 8px;">
            üìÖ Agendar agora
          </button>
        </div>
      `;
      return;
    }

    const listaComprovantes = JSON.parse(comprovantes);
    await carregarServicos();
    
    let html = '';
    listaComprovantes.forEach(ag => {
      const servico = servicos.find(s => s.nome === ag.servico);
      
      const dataObj = new Date(ag.data + 'T' + ag.horario);
      const dataFormatada = dataObj.toLocaleDateString('pt-BR');
      
      html += `
        <div style="background: white; border-radius: 20px; padding: 24px; margin-bottom: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; position: relative;">
          
          <!-- CABE√áALHO COM SERVI√áO E LIXEIRA -->
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
            <div>
              <span style="font-size: 20px; font-weight: 700; color: #0f172a;">${ag.servico}</span>
              <span style="display: inline-block; margin-left: 12px; padding: 4px 12px; background: #f1f5f9; border-radius: 100px; font-size: 13px; color: #475569;">
                ‚è±Ô∏è ${servico?.tempo_minutos || 30}min
              </span>
            </div>
            <button onclick="abrirModalExclusao('${ag.id}', 'cliente')" style="background: none; border: none; font-size: 22px; cursor: pointer; padding: 4px; color: #94a3b8; transition: color 0.2s;">
              üóëÔ∏è
            </button>
          </div>
          
          <!-- GRID DE INFORMA√á√ïES -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
              <div style="font-size: 12px; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">üë®‚Äçüíº Profissional</div>
              <div style="font-weight: 600; color: #0f172a; font-size: 16px;">${ag.profissional}</div>
            </div>
            <div>
              <div style="font-size: 12px; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">üìÖ Data</div>
              <div style="font-weight: 600; color: #0f172a; font-size: 16px;">${dataFormatada}</div>
            </div>
            <div>
              <div style="font-size: 12px; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">‚è∞ Hor√°rio</div>
              <div style="font-weight: 600; color: #0f172a; font-size: 16px;">${ag.horario}</div>
            </div>
            <div>
              <div style="font-size: 12px; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">üí∞ Valor</div>
              <div style="font-weight: 700; color: #059669; font-size: 18px;">R$ ${parseFloat(ag.valor).toFixed(2)}</div>
            </div>
          </div>
          
          <!-- STATUS E C√ìDIGO -->
          <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 16px; border-top: 2px solid #f1f5f9;">
            <div>
              <span style="display: inline-flex; align-items: center; gap: 6px; background: #dbeafe; padding: 6px 16px; border-radius: 100px; font-size: 13px; font-weight: 600; color: #2563eb;">
                <span style="font-size: 14px;">üü°</span> Confirmado
              </span>
            </div>
            <div style="display: flex; flex-direction: column; align-items: flex-end;">
              <span style="font-size: 11px; color: #64748b; margin-bottom: 4px;">C√≥digo</span>
              <span style="font-family: 'Courier New', monospace; font-size: 18px; font-weight: 700; color: #3b82f6; letter-spacing: 2px; background: #eff6ff; padding: 4px 12px; border-radius: 8px;">
                ${ag.codigo}
              </span>
            </div>
          </div>
          
          <!-- RODAP√â COM TELEFONE -->
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px dashed #e2e8f0; font-size: 13px; color: #64748b; display: flex; justify-content: space-between;">
            <span>üì± ${ag.telefone}</span>
            <span>üë§ ${ag.cliente}</span>
          </div>
          
        </div>
      `;
    });

    container.innerHTML = html;

  } catch (error) {
    console.error(error);
    container.innerHTML = `
      <div style="text-align: center; padding: 40px; color: #ef4444;">
        ‚ö†Ô∏è<br>
        <h3>Erro ao carregar</h3>
        <button class="btn-limpar" onclick="carregarAgendaCliente()">Tentar novamente</button>
      </div>
    `;
  }
}
  

async function apagarAgendamentoIndividual(agendamentoId, origem) {
  try {
    await fetchSupabase(`agenda?id=eq.${agendamentoId}`, {
      method: 'DELETE'
    });
    
    // Remover da lista de comprovantes
    let comprovantes = localStorage.getItem('todos_comprovantes');
    if (comprovantes) {
      let lista = JSON.parse(comprovantes);
      lista = lista.filter(c => c.id !== agendamentoId);
      localStorage.setItem('todos_comprovantes', JSON.stringify(lista));
    }
    
    mostrarMensagem('Agendamento apagado!', 'sucesso');
    
    if (origem === 'cliente') {
      await carregarAgendaCliente();
    } else if (origem === 'admin') {
      await carregarAgendamentos();
      carregarTodosAgendamentos();
    }
    
  } catch (error) {
    mostrarMensagem('Erro ao apagar agendamento', 'erro');
  }
}

async function excluirFolgaPelaData() {
  const data = document.getElementById('dataFolga').value;
  if (!data) return mostrarMensagem('Selecione uma data!','erro');
  
  try {
    await fetchSupabase(`folgas?data_folga=eq.${data}`, {method:'DELETE'});
    await carregarFolgas();
    document.getElementById('motivoFolga').value='';
    if (telaAtual==='calendario') gerarCalendario();
    mostrarMensagem('Folga exclu√≠da!','sucesso');
  } catch(e) {
    mostrarMensagem('Erro','erro');
  }
}

async function atualizarBadgeAdmin() {
  const badge = document.getElementById('badgeNovos');
  // Busca agendamentos do banco
  const agendamentos = await fetchSupabase('agenda?select=*&status=eq.confirmado');
  const totalAgendamentos = agendamentos.length;
  // Se N√ÉO for admin, esconde tudo
  if (!verificarSessaoAdmin()) {
    badge.style.display = 'none';
    if ('clearAppBadge' in navigator) navigator.clearAppBadge();
    return;
  }
  // SE FOR ADMIN, mostra se tiver agendamentos
  if (totalAgendamentos > 0) {
    // Mostra SINO üîî
    badge.innerHTML = 'üîî';
    badge.style.display = 'flex';
    badge.style.fontSize = '16px';
    badge.style.background = 'none';
    badge.style.minWidth = 'auto';
    badge.style.padding = '0';
    // Badge nativo do PWA
    if ('setAppBadge' in navigator) {
      navigator.setAppBadge(1);
    }
     // VIBRA√á√ÉO (s√≥ se for novo)
    if (totalAgendamentos > agendamentosVistos) {
      if ('vibrate' in navigator) {
        navigator.vibrate([200, 100, 200]);
      }
      agendamentosVistos = totalAgendamentos;
    }
  } else {
    badge.style.display = 'none';
    if ('clearAppBadge' in navigator) navigator.clearAppBadge();
  }
}
  
const ADMIN_SESSION_KEY = 'admin_session';

function verificarSessaoAdmin() {
  const sessao = localStorage.getItem(ADMIN_SESSION_KEY);
  if (!sessao) return false;
  const { expiraEm } = JSON.parse(sessao);
  if (Date.now() > expiraEm) { localStorage.removeItem(ADMIN_SESSION_KEY); return false; }
  document.getElementById('btnAdmin').innerHTML = 'üëë ADM';
  return true;
}

function criarSessaoAdmin(manterConectado) {
  const agora = Date.now();
  const expiraEm = manterConectado ? agora + (30 * 24 * 60 * 60 * 1000) : agora + (24 * 60 * 60 * 1000);
  const sessao = { timestamp: agora, expiraEm: expiraEm, manterConectado: manterConectado };
  localStorage.setItem(ADMIN_SESSION_KEY, JSON.stringify(sessao));
  document.getElementById('btnAdmin').innerHTML = 'üëë ADM';
}

function sairAdmin() {
  localStorage.removeItem(ADMIN_SESSION_KEY);
  document.getElementById('btnAdmin').innerHTML = '‚öôÔ∏è ADM';

  agendamentosVistos = 0;
  document.getElementById('badgeNovos').style.display = 'none';
  if ('clearAppBadge' in navigator) navigator.clearAppBadge();
  
  mostrarTela('inicio');
}

function mostrarLoginAdmin() {
  if (verificarSessaoAdmin()) {
    mostrarTela('admin');
  } else {
    document.getElementById('telaLoginAdmin').style.display = 'flex';
    document.getElementById('codigoAdmin').focus();
  }
}

function fecharLoginAdmin() {
  document.getElementById('telaLoginAdmin').style.display = 'none';
  document.getElementById('codigoAdmin').value = '';
}

async function entrarAdmin() {
  const codigo = document.getElementById('codigoAdmin').value;
  const manterConectado = document.getElementById('manterConectado').checked;
  
  try {
    
    const dados = await fetchSupabase('dono1?select=codigo_admin');
    const codigoCorreto = dados[0]?.codigo_admin;
    localStorage.setItem('admin_senha', codigo);


    if (codigo === codigoCorreto) {
      criarSessaoAdmin(manterConectado);
      fecharLoginAdmin();
      mostrarTela('admin');
      mostrarMensagem('Acesso concedido! üëë', 'sucesso');
    
      const agendamentos = await fetchSupabase('agenda?select=*&status=eq.confirmado');
      agendamentosVistos = agendamentos.length;
      document.getElementById('badgeNovos').style.display = 'none';
      if ('clearAppBadge' in navigator) navigator.clearAppBadge();

    } else {
      mostrarMensagem('C√≥digo inv√°lido!', 'erro');
    }
  } catch (error) {
    mostrarMensagem('Erro ao verificar c√≥digo', 'erro');
  }
}

async function carregarAdmin() {
  if (!verificarSessaoAdmin()) { mostrarLoginAdmin(); return; }

document.getElementById('todosAgendamentos').style.display = 'block';
document.getElementById('triangulo').innerHTML = '‚ñº';
  
  try {
    await Promise.all([carregarAgendamentos(), carregarServicos(), carregarConfiguracoes(), carregarFolgas(), carregarClientes()]);
    carregarTodosAgendamentos();
    carregarSelectAgendamentos();
    carregarServicosAdmin();
    
    if (configuracoes.horario_almoco_inicio) document.getElementById('almocoInicio').value = configuracoes.horario_almoco_inicio;
    if (configuracoes.horario_almoco_fim) document.getElementById('almocoFim').value = configuracoes.horario_almoco_fim;
    
    const hoje = new Date();
    const hojeFormatado = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}-${String(hoje.getDate()).padStart(2, '0')}`;
    document.getElementById('dataFolga').min = hojeFormatado;
    document.getElementById('dataFolga').value = hojeFormatado;
    
  } catch (error) {
    mostrarMensagem('Erro ao carregar admin', 'erro');
  }
}

function carregarTodosAgendamentos() {
  const container = document.getElementById('todosAgendamentos');
  
  if (agendamentos.length === 0) {
    container.innerHTML = '<p style="color: #64748b; text-align: center; padding: 20px;">Nenhum agendamento</p>';
    return;
  }
  
  let html = '';
  agendamentos.forEach(ag => {
    const cliente = clientesCache[ag.cliente_id];
    const servico = servicos.find(s => s.id === ag.servico_id);
    
    if (!cliente || !servico) return;
    
    const [ano, mes, dia] = ag.data_agendamento.split('-').map(Number);
    const dataObj = new Date(ano, mes - 1, dia);
    const dataFormatada = dataObj.toLocaleDateString('pt-BR');
    const statusColor = ag.status === 'concluido' ? '#10b981' : ag.status === 'confirmado' ? '#3b82f6' : '#ef4444';
    
    html += `
      <div class="agendamento-item" style="position: relative;">
        <button class="lixeira-individual" onclick="apagarAgendamentoIndividual('${ag.id}', 'admin')">üóëÔ∏è</button>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div><strong>Cliente:</strong> <span>${cliente.nome}</span></div>
          <div><strong>Telefone:</strong> <span>${cliente.telefone}</span></div>
          <div><strong>Data/Hor√°rio:</strong> <span>${dataFormatada} - ${ag.horario}</span></div>
          <div><strong>Servi√ßo:</strong> <span>${servico.nome}</span></div>
          <div><strong>Profissional:</strong> <span>${servico.profissional}</span></div>
          <div><strong>Status:</strong> <span style="color: ${statusColor}; font-weight: 700;">${ag.status === 'concluido' ? '‚úÖ CONCLU√çDO' : ag.status}</span></div>
          <div><strong>C√≥digo:</strong> <span style="color: #3b82f6; font-weight: 600;">${ag.codigo_confirmacao || ''}</span></div>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

async function carregarSelectAgendamentos() {
  const select = document.getElementById('selectAgendamento');
  select.innerHTML = '<option value="">Selecione...</option>';
  
  await carregarClientes();
  
  const agendamentosAtivos = agendamentos.filter(a => a.status !== 'concluido' && a.status !== 'cancelado');
  
  agendamentosAtivos.forEach(ag => {
    const cliente = clientesCache[ag.cliente_id];
    const servico = servicos.find(s => s.id === ag.servico_id);
    
    if (cliente && servico) {
      const [ano, mes, dia] = ag.data_agendamento.split('-').map(Number);
      const dataObj = new Date(ano, mes - 1, dia);
      const dataFormatada = dataObj.toLocaleDateString('pt-BR');
      
      const option = document.createElement('option');
      option.value = ag.id;
      option.textContent = `${dataFormatada} ${ag.horario} - ${cliente.nome} (${servico.nome})`;
      option.setAttribute('data-cliente-nome', cliente.nome);
      option.setAttribute('data-cliente-telefone', cliente.telefone);
      option.setAttribute('data-servico-nome', servico.nome);
      option.setAttribute('data-profissional', servico.profissional);
      option.setAttribute('data-horario', ag.horario);
      option.setAttribute('data-codigo', ag.codigo_confirmacao || '');
      select.appendChild(option);
    }
  });
  
  select.addEventListener('change', function() {
    const option = this.options[this.selectedIndex];
    if (option.value) {
      document.getElementById('detNome').textContent = option.getAttribute('data-cliente-nome');
      document.getElementById('detTelefone').textContent = option.getAttribute('data-cliente-telefone');
      document.getElementById('detServico').textContent = option.getAttribute('data-servico-nome');
      document.getElementById('detProfissional').textContent = option.getAttribute('data-profissional');
      document.getElementById('detHorario').textContent = option.getAttribute('data-horario');
      document.getElementById('detCodigo').textContent = option.getAttribute('data-codigo');
      document.getElementById('detalhesAgendamento').style.display = 'block';
    } else {
      document.getElementById('detalhesAgendamento').style.display = 'none';
    }
  });
}

async function marcarConcluido() {
  const select = document.getElementById('selectAgendamento');
  const agendamentoId = select.value;
  
  if (!agendamentoId) { mostrarMensagem('Selecione um agendamento!', 'erro'); return; }
  
  try {
    await fetchSupabase(`agenda?id=eq.${agendamentoId}`, {
      method: 'PATCH',
      body: JSON.stringify({ status: 'concluido' })
    });
    
    mostrarMensagem('Agendamento conclu√≠do! ‚úÖ', 'sucesso');
    await carregarAgendamentos();
    carregarTodosAgendamentos();
    carregarSelectAgendamentos();
    document.getElementById('detalhesAgendamento').style.display = 'none';
    select.value = '';
    
  } catch (error) {
    mostrarMensagem('Erro ao marcar como conclu√≠do', 'erro');
  }
}

function carregarServicosAdmin() {
  const container = document.getElementById('listaServicosAdmin');
  let html = '';
  servicos.forEach(servico => {
    html += `
      <div class="agendamento-item" style="margin-bottom: 10px; cursor: pointer;" onclick="selecionarServicoParaEditar('${servico.id}')">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div><strong>Servi√ßo:</strong> <span>${servico.nome}</span></div>
          <div><strong>Pre√ßo:</strong> <span style="color: #10b981;">R$ ${servico.preco.toFixed(2)}</span></div>
          <div><strong>Profissional:</strong> <span>${servico.profissional}</span></div>
          <div><strong>Tempo:</strong> <span>${servico.tempo_minutos} min</span></div>
        </div>
      </div>
    `;
  });
  container.innerHTML = html || '<p style="color: #64748b; text-align: center;">Nenhum servi√ßo</p>';
}

function selecionarServicoParaEditar(servicoId) {
  servicoEditando = servicos.find(s => s.id === servicoId);
  if (servicoEditando) {
    document.getElementById('editarServicoNome').value = servicoEditando.nome;
    document.getElementById('editarServicoPreco').value = servicoEditando.preco;
    document.getElementById('editarServicoProfissional').value = servicoEditando.profissional;
    document.getElementById('editarServicoDescricao').value = servicoEditando.descricao || '';
    document.getElementById('editarServicoTempo').value = servicoEditando.tempo_minutos;
    mostrarMensagem(`Editando: ${servicoEditando.nome}`, 'info');
  }
}

function imprimirComprovante() {
  const conteudo = document.querySelector('.ticket-agendamento').innerHTML;
  const janela = window.open('', '', 'width=800,height=600');
  janela.document.write(`<!DOCTYPE html><html><head><title>Comprovante</title><style>body{font-family:Arial;padding:20px}@media print{button{display:none}}</style></head><body>${conteudo}<script>window.onload=function(){window.print();setTimeout(()=>window.close(),1000)}<\/script></body></html>`);
  janela.document.close();
}

function mostrarMensagem(texto, tipo) {
  document.querySelectorAll('.mensagem').forEach(msg => msg.remove());
  
  const mensagem = document.createElement('div');
  mensagem.className = `mensagem ${tipo}`;
  mensagem.innerHTML = `
    ${tipo === 'sucesso' ? '‚úÖ' : tipo === 'erro' ? '‚ùå' : '‚ÑπÔ∏è'} 
    <span style="flex: 1;">${texto}</span>
    <button onclick="this.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer; font-size: 18px; padding: 0 5px;">‚úï</button>
  `;
  
  document.body.appendChild(mensagem);
  
  setTimeout(() => {
    if (mensagem.parentElement) mensagem.remove();
  }, 5000);
}

// ========== VARI√ÅVEIS E FUN√á√ÉO DO MODAL ==========
let idParaExcluir = null;
let origemParaExcluir = null;

window.abrirModalExclusao = function(agendamentoId, origem) {
  idParaExcluir = agendamentoId;
  origemParaExcluir = origem;
  document.getElementById('modalExcluir').style.display = 'flex';
}// modal
  
document.addEventListener('DOMContentLoaded', async () => {
  const hoje = new Date();
  const hojeFormatado = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}-${String(hoje.getDate()).padStart(2, '0')}`;
  
//  dataSelecionada = hojeFormatado;
  mesAtual = hoje.getMonth();
  anoAtual = hoje.getFullYear();
  
  verificarSessaoAdmin();
  
  try {
    await carregarServicos();
    await carregarFolgas();
  } catch (error) {
    console.error('Erro ao inicializar:', error);
  }
  
  mostrarTela('inicio');
  
  setInterval(atualizarBadgeAdmin, 10000);
  atualizarBadgeAdmin();
  
  // ========== BOT√ïES DO MODAL ==========
  
  // BOT√ÉO CONFIRMAR
  const btnConfirmar = document.getElementById('btnConfirmarExclusao');
  if (btnConfirmar) {
    btnConfirmar.addEventListener('click', async function() {
      if (idParaExcluir) {
        await apagarAgendamentoIndividual(idParaExcluir, origemParaExcluir);
        document.getElementById('modalExcluir').style.display = 'none';
        idParaExcluir = null;
      }
    });
  }
  
  // BOT√ÉO CANCELAR
  const btnCancelar = document.getElementById('btnCancelarExclusao');
  if (btnCancelar) {
    btnCancelar.addEventListener('click', function() {
      document.getElementById('modalExcluir').style.display = 'none';
      idParaExcluir = null;
    });
  }
  
  // CLICAR FORA FECHA
  window.addEventListener('click', function(e) {
    const modal = document.getElementById('modalExcluir');
    if (e.target === modal) {
      modal.style.display = 'none';
      idParaExcluir = null;
    }
  });
// fim
});
 
</script>



<!-- MODAL DE CONFIRMA√á√ÉO -->
<div id="modalExcluir" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 9999;">
  <div style="background: white; border-radius: 20px; padding: 30px; max-width: 350px; text-align: center;">
    <div style="font-size: 50px; margin-bottom: 20px;">üóëÔ∏è</div>
    <h3 style="margin-bottom: 15px;">Excluir agendamento?</h3>
    <p style="margin-bottom: 25px; color: #666;">Tem certeza? Essa a√ß√£o √© permanente.</p>
    <div style="display: flex; gap: 10px;">
      <button id="btnCancelarExclusao" style="flex: 1; padding: 12px; background: #f1f1f1; border: none; border-radius: 10px; cursor: pointer;">Cancelar</button>
      <button id="btnConfirmarExclusao" style="flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 10px; cursor: pointer;">Excluir</button>
    </div>
  </div>
</div>
 
  
</body>
</html>
